# FBV and CBV
> 8장. 함수 기반 뷰와 클래스 기반 뷰

## 1. 각각 언제 이용할 것인가?
django 는 `Function-based View(이하 함수 기반 뷰)` 와 `Class-based View(이하 클래스 기반 뷰)` 를 모두 지원한다.

언제 이 두 개를 사용해야 되는 지 헷갈리는 경우가 많다.

매번 뷰를 만들 때 둘 중 어떤 것이 더 잘 어울릴 지 생각해보라고 책에서 이야기한다.

Pydanny(Two scoops of django의 저자) 경우 클래스 기반 뷰를 선호한다고 한다.

하지만 이 책을 한국어로 번역해주신 김승진 역자님은 함수 기반 뷰를 선호하신다고 하셨다.

나도 아직은 클래스 기반 뷰에 익숙하지 않다보니 함수 기반 뷰가 선호된다.

하지만 최근 들어 클래스 기반 뷰의 강력함을 몸소 체험하고 있어서 다소 러닝커브가 있는 클래스 기반 뷰를 사용해보려고 노력하는 중에 있다.

책에서는 어떤 뷰를 선택할 지 고를 수 있게 도와주는 순서도가 있다. 참고하면 좋을 것 같다.


## 2. URLConf 로부터 뷰 로직을 분리하기

django로 오는 요청들은 보통 urls.py 에서 `URLConf` 를 통해 뷰로 라우팅 된다고 한다.

URL과 뷰의 결합은 유연성을 제공하기 위해 **최대한 느슨하게** 하라고 한다.

핵심은 `단순하고 명료하게 작성하라` 인 듯 하다.

뷰, URL, 모델 사이의 결합은 느슨하게 되어야 한다.

타이트하게 결합될 경우 재사용성이 떨어지기 때문이다.

클래스 기반 뷰에서 같거나 비슷한 인자들을 계속 사용하는 것은 `DRY(Don't Repeat Yourself)` 규칙에 어긋난다.

## 3. URLConf 에서 느슨한 결합 유지하기

반복되는 작업하지 않기 => 뷰들 사이에서 인자나 속성이 중복 사용되지 않는다.

느슨한 결합 => URLConf에서 모델과 템플릿 이름은 찾아볼 수 없다. 각 역할대로 분리를 잘 했다.

URLConf는 한 번에 한 가지 일을 잘 해야 한다.

클래스 기반에 대한 장점 => 뷰 모듈에서 표준화된 정의를 가짐으로써 상속해서 사용할 수 있게 된다. 재사용성이 늘어난다.

유연성 => 뷰 모델에서 표준화된 정의를 구현함에 따라 우리의 뷰는 커스텀 로직이라도 얼마든지 구현 가능하다.

### 3.1 클래스 기반 뷰를 사용하지 않는다면?

똑같다. URLConf의 관심사는 URL 이지 뷰가 아니다.

**늘 URLConf로부터 로직을 분리 운영하도록 하자**


## 4. URL에서 namespace 이용하기

URL namespace는 앱 레벨 또는 인스턴스 레벨에서 구분자를 제공해준다.

실제로 나는 앱 별로 사용중인데 매우매우 쓸만하다.

URL namespace 를 사용하면 `tasting_detail` 이라고 표현하던 URL 이름을 `tasting:detail` 로 보다 명확하게 사용할 수 있다.

### 4.1 URL 이름을 짧고, 명확하고, 반복되는 작업을 피해서 작성하는 방법

위에서 말한 것처럼 `tasting_detail`, `tasting_result` 처럼 작성하지 말고 `detail` 혹은 `result` 같은 명확한 표현으로 사용하자

### 4.2 서드 파티 라이브러리와 상호 운영성을 높이기

만약 URL 이름을 `leopold_detail` 이라고 작성헀는데 그런 이름을 가진 서드 파티 라이브러리를 사용한다고 가정했을 때, URL 이름이 겹쳐버리는 문제가 발생할 수도 있다는 것이다.

이런 문제를 URL namespace를 통해 간단히 해결할 수 있다고 하니 꼭 사용하자.

### 4.3 검색, 업그레이드, 리팩터링을 쉽게 하기

~~전부 같은 얘기지만 그래도 책에 있으니 적는다.~~

django는 매우 PEP-8 친화적인 프레임워크이다.

이런 사실을 상기하면서 `tasting_detail` 이라는 URL 이름을 보면 굉장히 검색이나 리팩터링에서 불확실하게 된다.

그래서 이런 것을 피하고자 URL namespace를 사용하면 다음과 같이 `tasting:detail` 로 나타낼 수 있으니 좀 더 명확하게 알 수 있어진다.

### 4.4 더 많은 앱과 템플릿 리버스 트릭을 허용하기

꼼수(trick)을 사용하지 않는다고 한다.

꼼수를 사용하면 복잡해지는 결과를 주기 때문이라고 한다.

하지만 간단한 꼼수를 알려주고 넘어간다.

- django-debug-toolbar: 이건 개인적으로 꼼수라고 생각하지 않고, 개발 도구 중에 필수품이라고 생각할 정도로 좋은 도구다. 사용하지 않고 있었다면 바로 사용하는 것을 추천한다.

이러한 꼼수를 알려주지만 늘 그렇듯이 가장 단순 명료한 해결 방안을 먼저 강구하고 시도하는 것이 좋다고 이야기 한다.


## 5. URLConf 에서 뷰를 문자열로 지목하지 말자

django의 예전 튜토리얼 에서는 urls.py 에서 뷰를 참조할 때 문자열의 형태로 작성되었다고 한다.(저는 django 1.8 버전 아래의 튜토리얼 문서를 본 적이 없어서 모르겠지만)

이렇게 문자열로 참조했을 때 몇 가지 문제가 따른다고 한다.

1. 뷰에서 에러가 발생할 경우 디버그가 힘들다.

2. 장고를 가르치는 강사들이 초보자들에게 urlpatterns 변수의 초깃값에서의 공백 문자열에 대해 설명해야 한다.(**이 부분은 django 1.10 버전에서 사라진 문법이다.**)

이 책은 django 1.8(LTS version) 기준으로 작성되었기 때문에 1.10 버전에서 안맞는 부분이 몇 가지 있다.

위에 언급한 부분이 그 부분들 중 하나이다.

아마 내 기억으로는 django 1.10 버전 올라오면서 부터 patterns 가 사라지고, 그냥 리스트 형태로 바뀐 것으로 알고 있다.

자세한 내용은 [여기](https://docs.djangoproject.com/en/1.10/releases/1.10/#features-removed-in-1-10) 에 있을 듯 하다.

그래서 그냥 

```python
urlpatterns = [
    url(r'^myview$', MyView.as_view(), name='my_view'),
]
```

정도로만 쓰면 된다.


## 6. 뷰에서 비즈니스 로직 분리하기

~~이 장 시작하기 전에는 되게 클래스 기반 뷰나 함수 기반 뷰에 대한 설명이 많을 줄 알았는데 아니었다~~

뷰에다가 비즈니스 로직을 구현할 경우 새로운 기능을 추가하게 될 떄 큰 장애로 대두되었다고 한다.

따라서 **모델 메서드, 매저니 메서드 또는 일반적인 유틸리티 헬퍼함수를 이용하는 전략을 선호** 하게 되었다고 한다.

비즈니스 로직이 쉽게 재사용이 가능하게 되고, 이를 뷰에서 호출하는 경우 확장하기가 쉽다.

나도 이 부분에 대해서는 동감한다. 뷰에 너무 많은 비즈니스 로직이 있을 경우 보기 불편하다.

그래서 책의 앞부분에서 거대 모델(Fat Model) 이라는 개념이 나온다.

## 7. 장고의 뷰와 함수

기본적으로 장고의 뷰 는 HTTP 요청하는 객체를 받아서 HTTP 응답하는 객체로 반환하는 함수다.

이런 개념은 클래스 기반 뷰이거나 함수 기반 뷰이거나 차이없이 동일하다.

### 7.1 뷰의 기본 형태들

코드를 최대한 안쓰고 싶었지만 써야겠다.(~~다른 이유는 아니고 귀찮아서...~~)

```python
from django.http import HttpResponse
from django.views.generic import View

def simplest_view(request):
    # 비즈니스 로직이 여기 위치한다
    return HttpResponse("함수 기반 뷰")


class SimplestView(View):
    def get(self, request, *arg, **kwargs):
        # 비즈니스 로직이 여기 위치한다
    return HttpResponse("클래스 기반 뷰")
```

두 개의 차이점이 드러난다.

클래스 기반 뷰의 경우 HTTP 메서드의 선언이 필요한 것에 반해 함수 기반 뷰는 따로 필요하지 않다.

다만, POST 메서드의 경우에는 두 개의 뷰 모두 따로 처리가 필요하다.


## 8. locals()를 뷰 콘텍스트에 이용하지 말자

locals()를 호출형 으로 반환하는 것은 안티 패턴이라고 한다.

어떤 이야기인지 locals() 라는 함수를 몰라서 자세하게 설명은 못하겠으나, **명시적인 콘텍스트를 이용하자** 라는 이야기 같으므로 넘어가겠다.

